import{n as e}from"./rolldown-runtime-y2wrX6ue.js";import{C as t,E as n,S as r,a as i,d as a,g as o,h as s,p as c,v as l,y as u}from"./bootstrap-vendor-LDj2otZe.js";import{A as d,f,g as p,k as m,m as h,r as g}from"./vendor-6AfST0Cy.js";import{i as _,n as v,r as y}from"./index-Bm7Tf09k.js";var b=e(n(),1),x=t(),S=({theme:e})=>{let{cartItems:t,cartTotal:n,clearCart:S}=v(),{currentUser:C}=y(),w=d(),T=m().state?.directCheckoutItems,E=T||t,D=E.reduce((e,t)=>e+t.price*t.quantity,0),[O,k]=(0,b.useState)(!1),[A,j]=(0,b.useState)(!0),[M,N]=(0,b.useState)({fullName:``,address:``,phone:``,city:``,paymentMethod:`cod`});(0,b.useEffect)(()=>{let e=!0;return(async()=>{if(!C){e&&j(!1);return}let t={fullName:C.displayName||``,phone:C.phoneNumber||``,address:``,city:``,paymentMethod:`cod`};try{let e=await g(h(_,`user_profiles`,C.uid));if(e.exists()){let n=e.data();t={fullName:n.name||t.fullName,phone:n.phone||t.phone,address:n.address||``,city:n.city||``,paymentMethod:`cod`}}else{let e=await g(h(_,`users`,C.uid));if(e.exists()){let n=e.data();t={fullName:n.name||n.displayName||t.fullName,phone:n.phone||n.phoneNumber||t.phone,address:n.address||``,city:n.city||``,paymentMethod:`cod`}}}}catch(e){console.error(`Error fetching user data:`,e)}finally{e&&(N(t),j(!1))}})(),()=>{e=!1}},[C]);let P=e=>{N({...M,[e.target.name]:e.target.value})},F=()=>Math.floor(1e7+Math.random()*9e7).toString();return E.length===0?(0,x.jsxs)(s,{className:`py-5 text-center`,style:{minHeight:`60vh`,display:`flex`,flexDirection:`column`,justifyContent:`center`},children:[(0,x.jsx)(`h2`,{className:`mb-3`,children:`Your cart is empty`}),(0,x.jsx)(u,{variant:`dark`,onClick:()=>w(`/shop`),children:`Go to Shop`})]}):(0,x.jsx)(`div`,{className:`checkout-page theme-${e} py-5`,children:(0,x.jsxs)(s,{children:[(0,x.jsx)(`h2`,{className:`mb-4 fw-bold`,children:`Checkout`}),(0,x.jsxs)(i,{children:[(0,x.jsx)(o,{lg:7,children:(0,x.jsxs)(l,{className:`border-0 shadow-sm mb-4`,children:[(0,x.jsx)(l.Header,{className:`bg-white py-3`,children:(0,x.jsx)(`h5`,{className:`mb-0 fw-bold`,children:`Shipping Details`})}),(0,x.jsx)(l.Body,{className:`p-4`,children:A?(0,x.jsxs)(`div`,{className:`text-center py-5`,children:[(0,x.jsx)(r,{animation:`border`,size:`sm`}),` Loading details...`]}):(0,x.jsxs)(c,{onSubmit:async e=>{e.preventDefault(),k(!0);try{let e=f(_),t=F(),n=h(_,`orders`,t),r={id:t,trackingId:t,userId:C?.uid||`guest`,userEmail:C?.email||`guest@example.com`,userDetails:M,items:E,totalAmount:D,status:`Pending`,createdAt:p(),isDirectBuy:!!T};if(e.set(n,r),C){let t=h(_,`user_profiles`,C.uid),n={uid:C.uid,email:C.email,name:M.fullName,phone:M.phone,address:M.address,city:M.city,updatedAt:p()};e.set(t,n,{merge:!0})}for(let t of E){let n=h(_,`products`,String(t.id)),r=await g(n);if(!r.exists())throw Error(`Product ${t.name} unavailable.`);let i=r.data().stock||0;if(i<t.quantity)throw Error(`${t.name} is out of stock.`);e.update(n,{stock:i-t.quantity})}await e.commit(),T||S(),alert(`Order Placed! Your Tracking ID is: #${t}`),w(`/dashboard`)}catch(e){console.error(`Order Failed:`,e),alert(`Order Failed: `+e.message)}finally{k(!1)}},children:[(0,x.jsxs)(c.Group,{className:`mb-3`,children:[(0,x.jsx)(c.Label,{children:`Full Name`}),(0,x.jsx)(c.Control,{type:`text`,name:`fullName`,value:M.fullName,onChange:P,required:!0})]}),(0,x.jsxs)(c.Group,{className:`mb-3`,children:[(0,x.jsx)(c.Label,{children:`Phone Number`}),(0,x.jsx)(c.Control,{type:`tel`,name:`phone`,value:M.phone,onChange:P,required:!0})]}),(0,x.jsxs)(c.Group,{className:`mb-3`,children:[(0,x.jsx)(c.Label,{children:`Address`}),(0,x.jsx)(c.Control,{as:`textarea`,rows:2,name:`address`,value:M.address,onChange:P,required:!0})]}),(0,x.jsxs)(i,{children:[(0,x.jsx)(o,{md:6,children:(0,x.jsxs)(c.Group,{className:`mb-3`,children:[(0,x.jsx)(c.Label,{children:`City`}),(0,x.jsx)(c.Control,{type:`text`,name:`city`,value:M.city,onChange:P,required:!0})]})}),(0,x.jsx)(o,{md:6,children:(0,x.jsxs)(c.Group,{className:`mb-3`,children:[(0,x.jsx)(c.Label,{children:`Payment Method`}),(0,x.jsx)(c.Select,{name:`paymentMethod`,value:M.paymentMethod,onChange:P,children:(0,x.jsx)(`option`,{value:`cod`,children:`Cash on Delivery`})})]})})]}),(0,x.jsx)(u,{variant:`success`,size:`lg`,type:`submit`,className:`w-100 mt-3 fw-bold`,disabled:O,children:O?(0,x.jsx)(r,{animation:`border`,size:`sm`}):`Place Order - $${D.toFixed(2)}`})]})})]})}),(0,x.jsx)(o,{lg:5,children:(0,x.jsxs)(l,{className:`border-0 shadow-sm bg-light`,children:[(0,x.jsx)(l.Header,{className:`bg-white py-3`,children:(0,x.jsx)(`h5`,{className:`mb-0 fw-bold`,children:`Order Summary`})}),(0,x.jsxs)(l.Body,{className:`p-4`,children:[(0,x.jsx)(a,{variant:`flush`,className:`mb-3`,children:E.map(e=>(0,x.jsxs)(a.Item,{className:`bg-transparent d-flex justify-content-between align-items-center px-0 py-3`,children:[(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`h6`,{className:`mb-0`,children:e.name}),(0,x.jsxs)(`small`,{className:`text-muted`,children:[`Qty: `,e.quantity]})]}),(0,x.jsxs)(`span`,{className:`fw-bold`,children:[`$`,(e.price*e.quantity).toFixed(2)]})]},e.id))}),(0,x.jsx)(`hr`,{}),(0,x.jsxs)(`div`,{className:`d-flex justify-content-between mt-3`,children:[(0,x.jsx)(`h4`,{className:`fw-bold`,children:`Total`}),(0,x.jsxs)(`h4`,{className:`fw-bold text-primary`,children:[`$`,D.toFixed(2)]})]})]})]})})]})]})})};export{S as default};