import{n as e}from"./rolldown-runtime-y2wrX6ue.js";import{C as t,E as n,S as r,a as i,g as a,h as o,p as s,v as c,y as l}from"./bootstrap-vendor-LDj2otZe.js";import{A as u,T as d,a as ee,c as f,d as p,g as m,i as h,j as g,m as te,o as ne,p as _,r as re,s as ie,t as v}from"./vendor-6AfST0Cy.js";import{B as y,C as b,W as x,Z as S,ct as C,et as w,f as T,lt as E,o as ae,tt as oe,v as D}from"./fontawesome-vendor-CDyZyS_m.js";import{i as O,n as se,r as ce}from"./index-Bm7Tf09k.js";var k=e(n(),1),A=t(),j=({theme:e})=>{let{id:t}=g(),{addToCart:n}=se(),{currentUser:j}=ce(),M=u(),[N,P]=(0,k.useState)(null),[F,I]=(0,k.useState)([]),[L,R]=(0,k.useState)(!0),[z,B]=(0,k.useState)(``),[V,H]=(0,k.useState)([]),[U,W]=(0,k.useState)({rating:5,text:``}),[le,G]=(0,k.useState)(!1),[ue,K]=(0,k.useState)(!0),[q,J]=(0,k.useState)(!1);(0,k.useEffect)(()=>{window.scrollTo(0,0)},[t]),(0,k.useEffect)(()=>{let e=!0;return R(!0),(async()=>{try{let n=await re(te(O,`products`,t));if(!e)return;if(n.exists()){let r={id:n.id,...n.data()};P(r),B(r.image);let i=await h(f(_(O,`products`),p(`category`,`==`,r.category),ee(5)));e&&I(i.docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.id!==t).slice(0,4))}else P(null)}catch(e){console.error(`Error loading product:`,e)}finally{e&&R(!1)}})(),()=>{e=!1}},[t]),(0,k.useEffect)(()=>{let e=ne(f(_(O,`reviews`),p(`productId`,`==`,t),ie(`createdAt`,`desc`)),e=>{H(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error(`Reviews Snapshot Error (Might need Index):`,e)});return()=>e()},[t]),(0,k.useEffect)(()=>{(async()=>{if(!j){G(!1),K(!1);return}K(!0);try{let e=await h(f(_(O,`orders`),p(`userId`,`==`,j.uid))),n=!1;e.forEach(e=>{let r=e.data();r.items&&Array.isArray(r.items)&&r.items.some(e=>String(e.id)===String(t))&&(n=!0)}),G(n)}catch(e){console.error(`Error verifying purchase:`,e)}finally{K(!1)}})()},[j,t]);let Y=()=>{!N||N.stock===0||M(`/checkout`,{state:{directCheckoutItems:[{...N,quantity:1}]}})},de=async e=>{if(e.preventDefault(),U.text.trim()){J(!0);try{await v(_(O,`reviews`),{productId:t,userId:j.uid,userName:j.displayName||j.email.split(`@`)[0]||`Verified Customer`,rating:U.rating,text:U.text,createdAt:m(),dateString:new Date().toLocaleDateString()}),W({rating:5,text:``}),alert(`Review submitted successfully!`)}catch(e){console.error(`Error submitting review:`,e),alert(`Failed to submit review. Please try again.`)}finally{J(!1)}}},X=e=>{let t=[];for(let n=1;n<=5;n++)n<=e?t.push((0,A.jsx)(E,{icon:w,className:`text-warning`},n)):n===Math.ceil(e)&&!Number.isInteger(e)?t.push((0,A.jsx)(E,{icon:oe,className:`text-warning`},n)):t.push((0,A.jsx)(E,{icon:w,className:`text-muted opacity-25`},n));return t};if(L)return(0,A.jsx)(`div`,{className:`d-flex justify-content-center align-items-center vh-100`,children:(0,A.jsx)(r,{animation:`border`,variant:`danger`})});if(!N)return(0,A.jsxs)(o,{className:`py-5 text-center`,children:[(0,A.jsx)(`h2`,{children:`Product not found`}),(0,A.jsx)(d,{to:`/shop`,className:`btn btn-outline-dark mt-3`,children:`Back to Shop`})]});let Z=N.stock||0,Q=Z===0,$=V.length>0?(V.reduce((e,t)=>e+t.rating,0)/V.length).toFixed(1):0;return(0,A.jsx)(`div`,{className:`product-details-page theme-${e}`,children:(0,A.jsxs)(o,{className:`py-5`,children:[(0,A.jsx)(`div`,{className:`mb-4`,children:(0,A.jsxs)(d,{to:`/shop`,className:`text-decoration-none text-muted fw-bold`,children:[(0,A.jsx)(E,{icon:ae,className:`me-2`}),` Back to Shop`]})}),(0,A.jsxs)(i,{className:`g-5`,children:[(0,A.jsxs)(a,{lg:6,children:[(0,A.jsxs)(`div`,{className:`main-image-wrapper mb-3 rounded-4 overflow-hidden shadow-sm position-relative`,children:[(0,A.jsx)(`img`,{src:z,alt:N.name,className:`img-fluid w-100 object-fit-cover`,style:{maxHeight:`500px`}}),Q&&(0,A.jsx)(`div`,{className:`position-absolute top-50 start-50 translate-middle bg-dark text-white px-4 py-2 rounded fw-bold opacity-75`,children:`SOLD OUT`})]}),(0,A.jsx)(`div`,{className:`d-flex gap-2`,children:[N.image,N.image,N.image].map((e,t)=>(0,A.jsx)(`div`,{className:`thumbnail-wrapper rounded-3 overflow-hidden border ${z===e?`border-primary border-2`:``}`,style:{width:`80px`,height:`80px`,cursor:`pointer`},onClick:()=>B(e),children:(0,A.jsx)(`img`,{src:e,alt:`Thumb`,className:`w-100 h-100 object-fit-cover`})},t))})]}),(0,A.jsx)(a,{lg:6,children:(0,A.jsxs)(`div`,{className:`product-info ps-lg-4`,children:[(0,A.jsxs)(`div`,{className:`d-flex align-items-center justify-content-between`,children:[(0,A.jsx)(`span`,{className:`badge bg-secondary mb-2 text-uppercase spacing-1`,children:N.category}),Q&&(0,A.jsx)(`span`,{className:`badge bg-danger mb-2`,children:`Sold Out`})]}),(0,A.jsx)(`h1`,{className:`display-5 fw-bold text-dark mb-2`,children:N.name}),(0,A.jsxs)(`div`,{className:`d-flex align-items-center mb-3`,children:[(0,A.jsx)(`div`,{className:`me-2 small`,children:X($)}),(0,A.jsxs)(`span`,{className:`text-muted small`,children:[`(`,V.length,` reviews)`]})]}),(0,A.jsxs)(`div`,{className:`d-flex align-items-center mb-4`,children:[(0,A.jsxs)(`h2`,{className:`text-primary fw-bold mb-0 me-3`,children:[`$`,N.price]}),Z>0&&Z<10&&(0,A.jsxs)(`span`,{className:`text-danger small fw-bold`,children:[(0,A.jsx)(E,{icon:T}),` Only `,Z,` left!`]})]}),(0,A.jsx)(`p`,{className:`lead text-secondary mb-4`,style:{fontSize:`1.1rem`,lineHeight:`1.8`},children:N.description||`Experience premium quality with this exclusive item. Crafted for excellence and designed to elevate your daily routine.`}),(0,A.jsxs)(`div`,{className:`d-flex gap-3 mb-5`,children:[(0,A.jsx)(l,{variant:Q?`secondary`:`outline-dark`,size:`lg`,className:`w-50 rounded-pill py-3 fw-bold d-flex align-items-center justify-content-center gap-2`,onClick:()=>n(N),disabled:Q,children:Q?`Out of Stock`:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(E,{icon:S}),` Add to Cart`]})}),(0,A.jsxs)(l,{variant:`primary`,size:`lg`,className:`w-50 rounded-pill py-3 fw-bold d-flex align-items-center justify-content-center gap-2 text-white`,onClick:Y,disabled:Q,style:{background:Q?`#ccc`:`#ec407a`,border:`none`},children:[(0,A.jsx)(E,{icon:b}),` Buy Now`]})]}),(0,A.jsxs)(`div`,{className:`features-list p-4 bg-light rounded-4`,children:[(0,A.jsxs)(`div`,{className:`d-flex align-items-center mb-2`,children:[(0,A.jsx)(E,{icon:D,className:`text-success me-3`,size:`lg`}),(0,A.jsx)(`span`,{children:`100% Authentic Product`})]}),(0,A.jsxs)(`div`,{className:`d-flex align-items-center mb-2`,children:[(0,A.jsx)(E,{icon:D,className:`text-success me-3`,size:`lg`}),(0,A.jsx)(`span`,{children:`Fast Delivery Available`})]}),(0,A.jsxs)(`div`,{className:`d-flex align-items-center`,children:[(0,A.jsx)(E,{icon:D,className:`text-success me-3`,size:`lg`}),(0,A.jsx)(`span`,{children:`7 Day Return Policy`})]})]})]})})]}),(0,A.jsx)(`div`,{className:`reviews-section mt-5 pt-5 border-top`,children:(0,A.jsxs)(i,{children:[(0,A.jsxs)(a,{lg:4,className:`mb-4 mb-lg-0`,children:[(0,A.jsx)(`h3`,{className:`fw-bold mb-3`,children:`Customer Reviews`}),(0,A.jsxs)(`div`,{className:`d-flex align-items-center mb-2`,children:[(0,A.jsx)(`h1`,{className:`fw-bold me-2 mb-0`,children:$}),(0,A.jsx)(`div`,{className:`text-warning`,children:X($)})]}),(0,A.jsxs)(`p`,{className:`text-muted small mb-4`,children:[`Based on `,V.length,` reviews`]}),(0,A.jsxs)(c,{className:`border-0 bg-light rounded-4 p-3`,children:[(0,A.jsx)(`h6`,{className:`fw-bold mb-3`,children:`Write a Review`}),ue?(0,A.jsxs)(`div`,{className:`text-center py-3`,children:[(0,A.jsx)(r,{animation:`grow`,size:`sm`}),` Checking eligibility...`]}):j?le?(0,A.jsxs)(s,{onSubmit:de,children:[(0,A.jsxs)(`div`,{className:`mb-3`,children:[(0,A.jsx)(`span`,{className:`me-2 small fw-bold`,children:`Rating:`}),[1,2,3,4,5].map(e=>(0,A.jsx)(E,{icon:w,className:`cursor-pointer ${e<=U.rating?`text-warning`:`text-secondary opacity-25`}`,style:{cursor:`pointer`},onClick:()=>W({...U,rating:e})},e))]}),(0,A.jsx)(s.Group,{className:`mb-3`,children:(0,A.jsx)(s.Control,{as:`textarea`,rows:3,placeholder:`Share your thoughts...`,className:`border-0 shadow-sm`,value:U.text,onChange:e=>W({...U,text:e.target.value}),required:!0})}),(0,A.jsx)(l,{variant:`dark`,size:`sm`,type:`submit`,className:`w-100 rounded-pill`,disabled:q,children:q?`Submitting...`:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(E,{icon:x,className:`me-2`}),` Submit Review`]})})]}):(0,A.jsxs)(`div`,{className:`text-center py-4 border rounded bg-white`,children:[(0,A.jsx)(E,{icon:T,className:`text-warning mb-2`,size:`lg`}),(0,A.jsx)(`p`,{className:`small text-muted mb-0 px-3`,children:`You must purchase this item to leave a review.`})]}):(0,A.jsxs)(`div`,{className:`text-center py-4`,children:[(0,A.jsx)(E,{icon:y,className:`text-muted mb-2`,size:`lg`}),(0,A.jsx)(`p`,{className:`small text-muted mb-3`,children:`Please login to write a review.`}),(0,A.jsx)(d,{to:`/login`,className:`btn btn-dark btn-sm rounded-pill w-100`,children:`Login Now`})]})]})]}),(0,A.jsx)(a,{lg:8,children:(0,A.jsx)(`div`,{className:`review-list ps-lg-4`,children:V.length===0?(0,A.jsx)(`div`,{className:`text-center py-5 text-muted`,children:(0,A.jsx)(`p`,{children:`No reviews yet. Be the first to review this product!`})}):V.map(e=>(0,A.jsxs)(`div`,{className:`review-item mb-4 pb-4 border-bottom`,children:[(0,A.jsxs)(`div`,{className:`d-flex justify-content-between align-items-start mb-2`,children:[(0,A.jsxs)(`div`,{className:`d-flex align-items-center`,children:[(0,A.jsx)(`div`,{className:`avatar-placeholder bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3`,style:{width:`40px`,height:`40px`},children:(0,A.jsx)(E,{icon:C,size:`lg`})}),(0,A.jsxs)(`div`,{children:[(0,A.jsx)(`h6`,{className:`fw-bold mb-0`,children:e.userName}),(0,A.jsx)(`div`,{className:`small text-warning`,style:{fontSize:`0.8rem`},children:X(e.rating)})]})]}),(0,A.jsx)(`span`,{className:`text-muted small`,children:e.dateString})]}),(0,A.jsx)(`p`,{className:`text-secondary mb-0 ps-5 ms-2`,children:e.text})]},e.id))})})]})}),F.length>0&&(0,A.jsxs)(`div`,{className:`related-products mt-5 pt-5 border-top`,children:[(0,A.jsx)(`h3`,{className:`fw-bold mb-4`,children:`You May Also Like`}),(0,A.jsx)(i,{className:`g-4`,children:F.map(e=>(0,A.jsx)(a,{xs:6,md:3,children:(0,A.jsx)(c,{className:`h-100 border-0 shadow-sm product-card-hover`,children:(0,A.jsxs)(d,{to:`/product/${e.id}`,className:`text-decoration-none text-dark`,children:[(0,A.jsx)(`div`,{className:`position-relative overflow-hidden rounded-top-3`,style:{height:`250px`},children:(0,A.jsx)(c.Img,{variant:`top`,src:e.image,className:`w-100 h-100 object-fit-cover`})}),(0,A.jsxs)(c.Body,{children:[(0,A.jsx)(c.Title,{className:`h6 text-truncate`,children:e.name}),(0,A.jsxs)(c.Text,{className:`fw-bold text-primary`,children:[`$`,e.price]})]})]})})},e.id))})]})]})})};export{j as default};